# 10.2 architeture fix
- Вот что получилось в итоге по архитектуре:
Выделил 4 слоя.
1. domain: Модели

2. interactor: Бизнес-логика. Тут нужны репозитории для работы. В этом слое описаны интерфейсы к репозиториям.
При создании интеракторов в него инжектятся через конструктор нужные реализации репозиториев.

3. data: Имплементации репозиториев. Сеть, сырые данные. Возвращают модели.

4. ui: экраны. Дергают interactor и получают от них данные

Т.е. можно выдернуть domain+interactor и использовать с другими data и ui

## 10.2
Довольно большое обновление. Извините, получилось в одном pr. Не очень будет удобно ревью делать )
Разбил на 3 слоя: data, domain, ui
### В слое data:
- модельки, которые используются в этом слое.
- Репозиторий PlaceRepository и его две имплементации. Memory и Network
Работает с данными мест. список, добавить, обновить и т.п.
Memory полностью работает, Network некоторые, пока не нужные методы, не стал делать. Но там в целом все понятно.
- Репозиторий LocationRepositoryMock - отдает фиктивное местоположение, в дальнейшем там будет работа с настоящим плагином.
- FavoritesRepository и VisitedRepository - хранят айдишники соответствующих мест. В дальнейшем там будет db
### В слое domain:
- модели, которые в ui используются
- mapper - преобразовывает модельки между слоями data/domain
- интерактор SightInteractor - вся логика работы с местами.
- SettingsInteractor - пока там только тема. Использовал уже ранее реализованное ThemeState, просто обернул в класс, на будущее.
### В ui
- использую Интеракторы, которые пока просто глобально объявлены.
- исправил везде чтобы данные через FutureBuilder шли из интерактора.
- поиск, фильтры и тп

Есть места, которые не реализованы.
- Поддержка сортировки favorites/visited карточек. На ui уже было сделано, но с моковыми данными. Надо в интерактор и далее в репозитории добавить поддержку.
- есть некоторые вопросы по api. Там на мой взгляд хорошо бы добавить метод получения записей с фильтром по id. Пока реализовал не слишком эффективно. См. в коде комент
- Есть некоторые глюки в ui. К примеру при возврате с bottomSheet, если там нажата favorites, то не обновляется favorite на карточке. Но причину знаю - исправится когда прикручу стейт-менеджмент.
- столкнулся с проблемой совместной работы FutureBuilder и Dismissible. Применил довольно грязный хак. Там в коде написал коммент и ссылочку.
- как лучше парсить json PlaceRepositoryNetwork? В отдельном изоляте или в основном. Хотя там небольшие jsonины, использовал compute на каждый запрос, но мне почему-то показалось что лаг. Наверно надо использовать менеджер изолятов. А может это показалось ))

Вообще задание довольно объемное получилось.

### 9.2.3 screen size
- на экране фильтра, если высота меньше чем 800, то показывает выбор категории в одну строку, со скроллом.

### 9_2_2 platform adaptation
- при клике на календарик в соответствии с платформой показывается соответствующий виджет.
реализовал showIosDatePicker для iOS, для удобства использования. Добавил еще кнопку подтверждения выбора.

### 9.2.1 orientation
- на экране "Список интересных мест" добавлена верстка в 2 колонки в альбомном режиме. Используя SliverGrid
- на экране "Избранное" добавлена верстка в 2 колонки в альбомном режиме, используя GridView

### 8.6 picker fix
- исправления по review. Добавлен гибкий механизм задания action-кнопок для карточки, через builder.

### 8.6 picker
- при клике на календарь в списке "Хочу посетить" открывается диалог выбора даты посещения
- немного реорганизован виджет SightCard, чтобы можно было добавлять разные кнопки: share, calendar, favorite, delete

### 8.2.2 add photo dialog fix
- диалог возвращает сразу SightPhoto, который потом будем получать с камеры и тп
- использовал enum вместо вспомогательного класса для определения выбора пользователя

### 8.2.2 add photo dialog
- добавлен диалог выбора источника фотографии

### 8.2.1 Sight detail bottom sheet fix 21.01.2021
- переделал bottomSheet на DraggableScrollableSheet.
Спасибо, то, что нужно. Теперь при свайпе вниз botoomSheet закрывается и возможность скролла сохранилась.
Добавил даже SliverPersistentHeader, реализованный ранее на SightDetailsScreen, чтобы карусель красиво схлопывалась и кнопочка закрытия исчезала от скролла.

- скруглил углы наверху. В теме прозрачный фон для bottomSheetTheme, а контент обернул в ClipRRect.

### 8.2.1 Sight detail bottom sheet
- Заменил страницу SightDetailsScreen на bottomSheet
Столкнулся с такой трудностью - не удавалось добиться одновременной возможности скролла контента на bottomSheet и свайпа вниз для закрытия.
Поэтому зафиксировал высоту карусели, а контент ниже сделал scrollable. Получилось, что свайпнув вниз по фото можно закрыть bottomSheet, а контент можно проскроллить.
см. видео


### 8.1 навигация
- экранам добавлены имена роутов как статические константы класса, чтобы опечатки не тревожили
- аргументы на некоторые экраны передаются через конструктор, т.к. они используются в initState и из context их еще не вытащить в том месте.
- расставлены переходы на экраны через pushNamed и тп.
- BottomNavigationBar обернут в Hero для имитации "persistent" поведения при переходах между экранами.

### 7.2 SplashScreen
- добавлен splash-экран, на котором вызывается инициализация приложения и авто-переход
на следующую страницу.

### 6.6.2 Sliver on SightListScreen
- верстка сливерами.
В макете figma заголовок в две строки в развернутом виде и в одну строку в свернутом.
По идее это к дизайнеру надо постучаться для прояснения.
Попытался решить в лоб. Хотя эти переносы смотрятся не очень )

### 6.6.1 Sliver на SightDetailsScreen
- Галерея фото переделана на sliver. Использовал SliverPersistentHeader с делегатом для тренировки.

### 6.4.2  OnBoarding screen  11.01.2021
- добавлена страница онбординга на PageView

### 6.4.1 Carousel (PageView)
- на экран SightDetailsScreen добавлена карусель для фото. С индикатором.
Изменил немного стиль индикатора - accent цвет, вместо темного в figma. Иначе на темных фото его не видно.


### 6.2 ListView
- добавлен ListView на списке фото. В других местах уже использовался.
- Добавлена физика скроллов.

### 5.6 правки по review
- заменил UniqueKey на ObjectKey.
В инспекторе увидел, что теперь виджеты переиспользуются при манипуляциях.
С UniqueKey они создавались заново.

### 5.6.3 29.12.2020
- сортировка Хочу посетить и Посещенные через Draggable
- удаление из Хочу посетить и Посещенные  через Dismissible

### 5.6.1
- на страницу добавления места добавлена функция добавления фотографий места =)))
- удаление фотографии по клику на крестик.
- удаление фотографии по свайпу вверх.

### 5.4.1 Search screen
- добавлена панель поиска на SightListScreen. При клике на нее переход на SightSearchScreen
- кнопка фильтра в панеле поиска ведет на экран FiltersScreen
- список мест на SightListScreen с учетом установленного фильтра
- добавлен экран SightSearchScreen. Поиск с учетом установленного фильтра.
- история поиска на странице SightSearchScreen

Демонстрация на видео:  https://youtu.be/Cj_mlXcy6_s

### правки по review
- файлы с виджетами переместил отдельно от экранов, для повышения читаемости
- калбеки от кнопочек (onTap и тп) сделал not null + assert, чтобы в будущем было явно почему кнопка не нажимается.
- мелкий рефакторинг

### 5.4.1  Add sight screen
- добавлен экран AddSightScreen
- для реализации логики с кнопкой очистки добавлен виджет TextFieldWithLabel
- для выбора категории добавлен экран SelectCategoryScreen
- добавлена кнопка Новое место на странице SightListScreen
- введенные данные добавляются в mocks

### Правки по review

* выделил отдельно виджеты кнопок IconElevatedButton, IconTextButton

* заменил везде Icon на Svg которые взял из figma.
Для этого реализовал класс SvgIcon, с поведением похожем на Icon.
А список доступных svg-иконок заданы как константы в SvgIcons.

* в Sight встроил сущность SightType. Она будет вычисляться на этапе получения данных с api.
Список defaultSightTypes содержит предустановленные категории для фильтра.

* вместо Expanded(child: Container()), используется Spacer()

* вынес builder от GridView на FiltersScreen в отдельную функцию для читаемости

### 5.2.4 Ripple на карточке места 20.12.2020
* в карточке места добавлены эффекты ripple. При клике на карточку, ripple по всей карточке. При клике на сердечко, ripple внутри кнопки.
Для реализации использовал Stack - рисую ripple поверх содержимого карточки

### 5.2.3 Экран SettingsScreen 20.12.2020
* Добавил ThemeState - репозиторий для хранения текущей темы.
* экран SettingsScreen с переключателем темы

### 5.2.2 Экран фильтров 20.12.2020
* добавил слайдер от 100м до 10км. Используются моковые данные текущей координаты и базы мест.
* добавил модельку SightType для того, чтобы связать Sight.type и иконку в фильтре на странице filters_screen.dart
* иконки взял из встроенных. Далее планирую сделать ttf c нужным набором из figma.
* моковые данные для категорий.
* фильтр по категориям.
* добавил в темы нужные настройки для слайдера и тп.

В текстовом описании задания немного по другому описано, чем в макете figma. У слайдера в макете две ручки. В общем, сделал как в макете.

### 5.2.1 19.12.2020
* Заменил свой кастомный виджет кнопки на стандартные TextButton, ElevatedButton. Стили определил в themes. Отлично! Раньше темы не использовал, оказалось очень удобно.

### 4.9
* добавил asserts для @required параметров в виджетах
* добавил в ui/res/themes.dart 2 темы: светлая/темная
* виджет App сделал stateful, чтобы организовать временный переключатель темы, доступный на всех страницах. Переключатель через FloatingActionButton.
* в разных виджетах проставил получение цветов из темы.

Вопрос: Принцип мне понятен. Но есть ли какое-то развернутое руководство по параметрам темы? Типа, где какой параметр используется. Делал наугад.